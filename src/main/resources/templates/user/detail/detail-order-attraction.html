<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${attraction.name} + ' - Explore'">Detail Atraksi</title>
</head>
<body>
    <th:block th:replace="~{fragment/user-layout :: layout(title=${attraction.name}, content=~{::content})}">
        <div th:fragment="content">
            
            <div class="relative w-full h-[60vh] group">
                
                <a th:href="@{/}" 
                   class="absolute top-6 left-6 md:left-12 z-30 w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 
                          bg-brand-dark/60 border-2 border-green-500 text-green-500 
                          shadow-[0_0_15px_rgba(34,197,94,0.3)] backdrop-blur-md
                          hover:bg-green-500 hover:text-white hover:scale-110 hover:shadow-[0_0_25px_rgba(34,197,94,0.6)]" 
                   title="Kembali ke Beranda">
                    <i class="ri-arrow-left-line text-xl font-bold"></i>
                </a>

                <img th:if="${attraction.image != null}" th:src="@{${attraction.imagePath}}" class="w-full h-full object-cover" data-speed="0.5">
                <img th:unless="${attraction.image != null}" src="https://source.unsplash.com/random/1600x900/?amusement-park,nature" class="w-full h-full object-cover" data-speed="0.5">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent via-brand-dark/50 to-brand-dark"></div>
                
                <div class="absolute bottom-0 left-0 w-full p-6 md:p-12 z-10">
                    <div class="container mx-auto">
                         <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-green-500/30 bg-green-500/10 backdrop-blur-md text-green-400 text-xs mb-4 uppercase tracking-widest font-bold">
                             <i class="ri-camera-3-fill"></i> <span th:text="${attraction.category}">Category</span>
                         </div>
                        <h1 class="text-5xl md:text-7xl font-serif italic text-white mb-2" th:text="${attraction.name}">Attraction Name</h1>
                        <p class="text-xl text-gray-300 flex items-center gap-2">
                            <i class="ri-map-pin-2-fill text-brand-accent"></i> <span th:text="${attraction.location}">Location</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="container mx-auto px-6 py-12 relative z-20 -mt-20">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                    
                    <div class="lg:col-span-2 space-y-10">
                        <div class="glass-panel p-8 rounded-3xl border border-white/5 shadow-2xl shadow-brand-dark/50">
                            <h2 class="text-2xl font-bold text-white mb-4">Experience</h2>
                            <p class="text-gray-400 leading-relaxed text-lg">
                                Temukan keajaiban di <span class="text-brand-accent font-semibold" th:text="${attraction.name}"></span>. 
                                Destinasi ini menawarkan pengalaman tak terlupakan yang memadukan keindahan, keseruan, dan kenangan abadi. 
                                Sempurna untuk pelarian sejenak dari rutinitas atau petualangan bersama orang tercinta.
                            </p>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="glass-panel p-5 rounded-2xl flex flex-col items-center justify-center text-center gap-3 hover:bg-white/5 transition group border border-white/5">
                                <div class="w-12 h-12 rounded-full bg-green-500/10 flex items-center justify-center text-green-400 group-hover:scale-110 transition-transform">
                                    <i class="ri-camera-lens-line text-2xl"></i>
                                </div>
                                <span class="text-sm text-gray-300 font-medium">Photo Spots</span>
                            </div>
                            <div class="glass-panel p-5 rounded-2xl flex flex-col items-center justify-center text-center gap-3 hover:bg-white/5 transition group border border-white/5">
                                <div class="w-12 h-12 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400 group-hover:scale-110 transition-transform">
                                    <i class="ri-user-star-line text-2xl"></i>
                                </div>
                                <span class="text-sm text-gray-300 font-medium">Tour Guide</span>
                            </div>
                            <div class="glass-panel p-5 rounded-2xl flex flex-col items-center justify-center text-center gap-3 hover:bg-white/5 transition group border border-white/5">
                                <div class="w-12 h-12 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-400 group-hover:scale-110 transition-transform">
                                    <i class="ri-restaurant-2-line text-2xl"></i>
                                </div>
                                <span class="text-sm text-gray-300 font-medium">Food Court</span>
                            </div>
                            <div class="glass-panel p-5 rounded-2xl flex flex-col items-center justify-center text-center gap-3 hover:bg-white/5 transition group border border-white/5">
                                <div class="w-12 h-12 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-400 group-hover:scale-110 transition-transform">
                                    <i class="ri-shopping-bag-3-line text-2xl"></i>
                                </div>
                                <span class="text-sm text-gray-300 font-medium">Souvenir</span>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="sticky top-28 glass-panel p-8 rounded-3xl border-t border-brand-accent/50 shadow-2xl shadow-brand-accent/5 bg-brand-surface/40 backdrop-blur-xl">
                            <h3 class="text-2xl font-serif italic text-white mb-6">Get your ticket</h3>
                            
                            <form th:action="@{/order/create}" method="post" class="space-y-6">
                                <input type="hidden" name="itemType" value="Attraction" />
                                <input type="hidden" id="selectedItemId" name="itemId" th:value="${tickets != null and !tickets.isEmpty() ? tickets[0].attractionTicketId : ''}" />

                                <div th:if="${tickets != null && !tickets.isEmpty()}">
                                    
                                    <div class="space-y-2">
                                        <label class="text-xs uppercase tracking-wider text-gray-500 font-bold">Ticket Type</label>
                                        <div class="relative">
                                            <select id="ticketSelect" name="itemId" onchange="updatePrice()" class="w-full bg-brand-dark/50 border border-white/10 text-white rounded-xl p-4 appearance-none focus:border-green-500 focus:ring-0 outline-none cursor-pointer transition-colors hover:bg-brand-dark/70">
                                                <option th:each="t : ${tickets}" 
                                                        th:value="${t.attractionTicketId}" 
                                                        th:data-price="${t.price}"
                                                        th:text="${t.ticketType} + ' (Rp ' + ${#numbers.formatDecimal(t.price, 0, 'POINT', 0, 'COMMA')} + ')'">
                                                    Ticket
                                                </option>
                                            </select>
                                            <i class="ri-coupon-3-line absolute right-4 top-4 text-green-500 pointer-events-none"></i>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <label class="text-xs uppercase tracking-wider text-gray-500 font-bold">Visit Date</label>
                                        <div class="relative">
                                            <input type="date" id="checkIn" name="checkIn" required 
                                                   class="w-full bg-brand-dark/50 border border-white/10 text-white rounded-xl p-4 focus:border-green-500 focus:ring-0 outline-none transition-colors [color-scheme:dark]">
                                        </div>
                                    </div>

                                    <div class="space-y-2 mt-4">
                                        <label class="text-xs uppercase tracking-wider text-gray-500 font-bold">Visitors</label>
                                        <div class="flex items-center bg-brand-dark/50 border border-white/10 rounded-xl p-2">
                                            <button type="button" onclick="adjustQty(-1)" class="w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 text-white transition-colors"><i class="ri-subtract-line"></i></button>
                                            <input type="number" id="qtyInput" name="quantity" value="1" min="1" onchange="updatePrice()" class="bg-transparent border-none text-center text-white font-bold w-full focus:ring-0 appearance-none">
                                            <button type="button" onclick="adjustQty(1)" class="w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 text-white transition-colors"><i class="ri-add-line"></i></button>
                                        </div>
                                    </div>

                                    <div class="py-6 border-b border-white/10 flex justify-between items-end">
                                        <span class="text-gray-400 text-sm">Total Price</span>
                                        <span id="displayPrice" class="text-3xl font-bold text-green-400">Rp 0</span>
                                    </div>

                                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2 mt-4 shadow-lg shadow-green-900/20">
                                        <span>Confirm Ticket</span>
                                        <i class="ri-ticket-2-line"></i>
                                    </button>
                                </div>
                                
                                <div th:unless="${tickets != null && !tickets.isEmpty()}" class="text-center py-8">
                                    <div class="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-500">
                                        <i class="ri-coupon-3-line text-2xl"></i>
                                    </div>
                                    <p class="text-gray-500">Tiket belum tersedia untuk saat ini.</p>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    document.getElementById('checkIn').valueAsDate = new Date();
                    updatePrice();
                });

                function updatePrice() {
                    const select = document.getElementById('ticketSelect');
                    const selectedOption = select.options[select.selectedIndex];
                    const price = parseFloat(selectedOption.getAttribute('data-price'));
                    const qty = parseInt(document.getElementById('qtyInput').value);

                    // Update Hidden Input ID
                    document.getElementById('selectedItemId').value = selectedOption.value;
                    
                    const total = price * qty;
                    const formatter = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 });
                    document.getElementById('displayPrice').innerText = formatter.format(total);
                }

                function adjustQty(amount) {
                    const input = document.getElementById('qtyInput');
                    let val = parseInt(input.value) + amount;
                    if(val < 1) val = 1;
                    input.value = val;
                    updatePrice();
                }
            </script>
        </div>
    </th:block>
</body>
</html>
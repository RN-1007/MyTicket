<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Orders</title>
</head>
<body>
    <th:block th:replace="~{fragment/user-layout :: layout(title='My Orders', content=~{::content})}">
        <div th:fragment="content">
            
            <div class="container mx-auto px-6 py-12">
                <div class="flex items-center gap-4 mb-10">
                    <div class="w-12 h-12 rounded-full bg-brand-accent flex items-center justify-center text-brand-dark text-xl font-bold">
                        <i class="ri-file-list-3-fill"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white">Your <span class="text-brand-accent font-serif italic">Journey</span> History</h1>
                        <p class="text-gray-400 text-sm">Semua riwayat petualangan Anda tercatat di sini.</p>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(orders)}" class="glass-panel p-20 rounded-3xl text-center">
                    <div class="w-24 h-24 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6 text-gray-500">
                        <i class="ri-space-ship-line text-4xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white">Belum ada perjalanan</h2>
                    <p class="text-gray-400 mb-8">Langit bukan batasnya. Mulai petualanganmu sekarang.</p>
                    <a th:href="@{/}" class="bg-brand-accent text-brand-dark px-8 py-3 rounded-full font-bold hover:bg-orange-600 transition">Explore Now</a>
                </div>

                <div class="grid gap-6">
                    <div th:each="order : ${orders}" class="glass-panel p-6 rounded-3xl flex flex-col md:flex-row justify-between items-center gap-6 group hover:border-brand-accent/30 transition-all duration-300">
                        
                        <div class="flex items-center gap-6 w-full md:w-auto">
                            <div class="w-16 h-16 rounded-2xl bg-brand-surface border border-white/10 flex flex-col items-center justify-center text-center">
                                <span class="text-xs text-gray-500 uppercase font-bold">ORD</span>
                                <span class="text-lg font-bold text-white font-serif" th:text="${order.orderId}">01</span>
                            </div>
                            <div>
                                <p class="text-xs text-brand-accent uppercase tracking-widest font-bold mb-1">Date Created</p>
                                <p class="text-white font-medium" th:text="${#dates.format(order.orderDate, 'dd MMM yyyy, HH:mm')}">Date</p>
                            </div>
                        </div>

                        <div class="flex-1 w-full md:w-auto border-l border-white/10 pl-0 md:pl-6">
                             <ul class="space-y-2">
                                <li th:each="detail : ${order.orderDetails}" class="flex items-center gap-3 text-sm text-gray-300">
                                    <i th:if="${detail.hotelRoom != null}" class="ri-hotel-bed-line text-brand-accent"></i>
                                    <i th:if="${detail.attractionTicket != null}" class="ri-camera-3-line text-brand-accent"></i>
                                    <i th:if="${detail.transportTicket != null}" class="ri-plane-line text-brand-accent"></i>
                                    
                                    <span class="font-bold text-white" th:text="${detail.quantity} + 'x'">1x</span>
                                    
                                    <span th:if="${detail.hotelRoom != null}" th:text="${detail.hotelRoom.roomType} + ' at ' + ${detail.hotelRoom.hotel.name}">Room</span>
                                    <span th:if="${detail.attractionTicket != null}" th:text="${detail.attractionTicket.attraction.name}">Attr</span>
                                    <span th:if="${detail.transportTicket != null}" th:text="${detail.transportTicket.transport.name}">Trans</span>
                                </li>
                            </ul>
                        </div>

                        <div class="flex flex-col items-end gap-2 w-full md:w-auto text-right">
                            <p class="text-2xl font-bold text-white" th:text="'Rp ' + ${#numbers.formatDecimal(#aggregates.sum(order.orderDetails.![totalPrice]), 0, 'POINT', 0, 'COMMA')}">Rp 0</p>
                            
                            <div class="flex items-center gap-3">
                                <span th:text="${order.status}"
                                      th:classappend="${order.status.name() == 'PAID'} ? 'bg-green-500/20 text-green-400 border-green-500/30' : 
                                                      ((${order.status.name() == 'PENDING'} or ${order.status.name() == 'WAITING_PAYMENT'}) ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30' : 
                                                      'bg-red-500/20 text-red-400 border-red-500/30')"
                                      class="px-4 py-1.5 rounded-full text-xs font-bold uppercase border backdrop-blur-md">
                                    Status
                                </span>
                                
                                <form th:if="${order.status.name() == 'PENDING'}" th:action="@{/pesanan/batalkan/{id}(id=${order.orderId})}" method="post" 
                                      onsubmit="return confirm('Batalkan pesanan ini?')">
                                    <button type="submit" class="w-8 h-8 rounded-full bg-red-500/10 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition">
                                        <i class="ri-close-line"></i>
                                    </button>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </th:block>
</body>
</html>